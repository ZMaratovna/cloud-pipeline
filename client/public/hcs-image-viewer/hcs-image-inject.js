(self.webpackChunkHcsImageViewer=self.webpackChunkHcsImageViewer||[]).push([[822],{1676:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return be}});var n=r(7462),i=r(7294),o=r(3935),a=r(5697),c=r.n(a),s=r(4942),u=r(8152),l={url:void 0,offsetsUrl:void 0,source:void 0,sourcePending:!1,sourceError:void 0,sourceCallback:void 0,loader:void 0,metadata:void 0,imageIndex:0,error:void 0,pending:!1},f=i.createContext(l),d="set-data",p="set-source-initializing",v="set-source",m="set-source-error",h="set-image";function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var j=function(e,t){switch(t.type){case d:return function(e,t){var r=t.url,n=t.offsetsUrl,i=t.callback,o=e.url,a=e.offsetsUrl;return o===r&&n===a?(i&&i(),e):y(y({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourcePending:!1,sourceError:!1,sourceCallback:i,error:void 0,url:r,offsetsUrl:n})}(e,t);case"set-error":return function(e,t){var r=t.error;return O(O({},e),{},{error:r})}(e,t);case p:return function(e){return x(x({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:void 0,sourcePending:!0})}(e);case m:return function(e,t){var r=t.error,n=e.sourceCallback;return"function"==typeof n&&setTimeout((function(){n({error:r})}),0),x(x({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:r,sourcePending:!1,sourceCallback:void 0})}(e,t);case v:return function(e,t){var r=t.source,n=e.sourceCallback;"function"==typeof n&&setTimeout((function(){n()}),0);var i=Array.isArray(r)?r:[r],o=i.map((function(e){return e.data})),a=i.map((function(e){return e.metadata}));return x(x({},e),{},{loader:o,metadata:a,imageIndex:0,source:r,sourceError:void 0,sourcePending:!1,sourceCallback:void 0})}(e,t);case h:return function(e,t){var r,n=t.index,i=t.ID,o=t.Name,a=t.search,c=e.metadata,s=void 0===c?[]:c;if(null!=n)r=s[n];else if(void 0!==i)r=s.find((function(e){return e.ID===i}));else if(void 0!==o)r=s.find((function(e){return(e.Name||e.name||"").toLowerCase()===o.toLowerCase()}));else if(a&&/^[\d]+_[\d]+$/.test(a)){var l=/^([\d]+)_([\d])+$/.exec(a),f=(0,u.Z)(l,3),d=f[1],p=f[2],v=new RegExp("^\\s*well\\s+".concat(d,"\\s*,\\s*field\\s+").concat(p,"\\s*$"),"i");r=s.find((function(e){return v.test(e.Name||e.name)}))}if(r){var m=s.indexOf(r);return x(x({},e),{},{imageIndex:m})}return e}(e,t);default:return e}},P=r(5861),S=r(3144),k=r(5671),z=r(136),C=r(4575),Z=r(1120),D=r(2407),E=r(7757),L=r.n(E),R=r(6752),I=r(4939);var M=function(e){(0,z.Z)(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,Z.Z)(t);if(r){var i=(0,Z.Z)(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return(0,C.Z)(this,e)});function i(e){var t;return(0,k.Z)(this,i),t=e?n.call(this,"offsets.json file not found: ".concat(e)):n.call(this,"offsets.json file not specified"),(0,C.Z)(t)}return(0,S.Z)(i)}((0,D.Z)(Error));function A(e,t,r){return V.apply(this,arguments)}function V(){return(V=(0,P.Z)(L().mark((function e(t,r,n){var i,o,a,c,s,u,l,f,d;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,I.W0)(t);case 2:return o=e.sent,e.next=5,o.getImage(0);case 5:if(a=e.sent,!Boolean(null==a||null===(i=a.fileDirectory)||void 0===i?void 0:i.SubIFDs)){e.next=9;break}return e.abrupt("return",r.reduce((function(e,t){var r=t.Pixels;return r.SizeC*r.SizeT*r.SizeZ+e}),1));case 9:return c=n[0].length,s=r[0].Pixels,u=s.SizeC,l=s.SizeT,f=s.SizeZ,d=u*l*f,e.abrupt("return",d*c);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return U=(0,P.Z)(L().mark((function e(){var t,r,n,i,o,a,c,s=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},r=t.url,!(n=t.offsetsUrl)){e.next=8;break}return e.next=5,fetch(n);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=void 0;case 9:if(i=e.t0,o=!i||!i.ok){e.next=17;break}return e.next=14,i.json();case 14:e.t1=e.sent,e.next=18;break;case 17:e.t1=void 0;case 18:return a=e.t1,e.next=21,(0,R.$L)(r,{offsets:a,images:"all"});case 21:if(c=e.sent,!o){e.next=28;break}return e.next=25,A(r,c.map((function(e){return e.metadata})),c.map((function(e){return e.data})));case 25:if(!(e.sent>40)){e.next=28;break}throw new M(n);case 28:return e.abrupt("return",c);case 29:case"end":return e.stop()}}),e)}))),U.apply(this,arguments)}function N(e){var t=e.Pixels,r=t.Channels.length,n=t.Channels[0].SamplesPerPixel,i=3===r&&"uint8"===t.Type,o=3===t.SizeC&&1===r&&t.Interleaved;return 3===n||i||o}function T(e){var t=e.imageIndex,r=void 0===t?0:t,n=e.loader,i=void 0===n?[]:n;if(!(r<0||r>=i.length))return i[r]}function $(e){var t=e[e.length-1];return 3===t||4===t}var B=r(5451);function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var W=["z","t"];function _(e){for(var t=[],r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W,r=e.labels,n=e.shape;return r.map((function(e,t){return{name:e,midpoint:Math.floor((n[t]||0)/2)}})).filter((function(e){return t.includes(e.name)})).map((function(e){var t=e.name,r=e.midpoint;return(0,s.Z)({},t,r)})).reduce((function(e,t){return H(H({},e),t)}),{})}(e),n=e.labels.map((function(t,r){return{name:t,size:e.shape[r]}})).find((function(e){return!W.includes(e.name)&&e.size})),i=0;i<Math.min(4,n.size);i+=1)t.push(H((0,s.Z)({},n.name,i),r));return $(e.shape)?[H(H({},t[0]),{},{c:0})]:t}function q(e){return J.apply(this,arguments)}function J(){return(J=(0,P.Z)(L().mark((function e(t){var r,n,i,o,a,c,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.loader,n=t.selection,i=Array.isArray(r)?r[r.length-1]:r,e.next=4,i.getRaster({selection:n});case 4:return o=e.sent,a=(0,R.mx)(o.data),c=a.domain,s=a.contrastLimits,e.abrupt("return",{domain:c,contrastLimits:s});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return K.apply(this,arguments)}function K(){return(K=(0,P.Z)(L().mark((function e(t){var r,n,i,o,a,c,s,u,l,f,d,p;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.loader,n=t.selection,i=r[r.length-1],o=i.shape,a=i.labels,c=o[a.indexOf("z")]>>r.length-1,e.next=6,i.getRaster({selection:H(H({},n),{},{z:0})});case 6:return s=e.sent,e.next=9,i.getRaster({selection:H(H({},n),{},{z:Math.floor(c/2)})});case 9:return u=e.sent,e.next=12,i.getRaster({selection:H(H({},n),{},{z:Math.max(0,c-1)})});case 12:return l=e.sent,f=(0,R.mx)(s.data),d=(0,R.mx)(u.data),p=(0,R.mx)(l.data),e.abrupt("return",{domain:[Math.min(f.domain[0],d.domain[0],p.domain[0]),Math.max(f.domain[1],d.domain[1],p.domain[1])],contrastLimits:[Math.min(f.contrastLimits[0],d.contrastLimits[0],p.contrastLimits[0]),Math.max(f.contrastLimits[1],d.contrastLimits[1],p.contrastLimits[1])]});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){return X.apply(this,arguments)}function X(){return(X=(0,P.Z)(L().mark((function e(t){var r,n,i,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.loader,n=t.selection,i=t.use3d,o=i?G:q,e.abrupt("return",o({loader:r,selection:n}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return ee.apply(this,arguments)}function ee(){return(ee=(0,P.Z)(L().mark((function e(t){var r,n,i,o,a,c;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.loader,n=t.selections,i=t.use3d,e.next=3,Promise.all(n.map((function(e){return Q({loader:r,selection:e,use3d:i})})));case 3:return o=e.sent,a=o.map((function(e){return e.domain})),c=o.map((function(e){return e.contrastLimits})),e.abrupt("return",{domains:a,contrastLimits:c});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){var t=Array.isArray(e)?e[0]:e,r=t.shape,n=t.labels,i=function(e){var t,r,n=null!==(t=null==e||null===(r=e.meta)||void 0===r?void 0:r.physicalSizes)&&void 0!==t?t:{},i=n.x,o=n.y,a=n.z;if(null!=i&&i.size&&null!=o&&o.size&&null!=a&&a.size){var c=Math.min(a.size,i.size,o.size),s=[i.size/c,o.size/c,a.size/c];return(new B.Z).scale(s)}return(new B.Z).identity()}(t);return[[0,i[0]*r[n.indexOf("x")]],[0,i[5]*r[n.indexOf("y")]],[0,i[10]*r[n.indexOf("z")]]]}function re(e,t){return e.Name||e.name||e.ID||"Channel ".concat(t+1)}var ne=[255,0,0],ie=[0,255,0],oe=[0,0,255],ae=[255,255,255],ce=[0,255],se=[oe,ie,[255,0,255],[255,255,0],[255,60,0],[154,0,255],ae,ne],ue="set-default";function le(){return{channels:[],channelsVisibility:[],selections:[],globalSelection:[],colors:[],domains:[],contrastLimits:[],useLens:!1,useColorMap:!1,use3D:!1,pixelValues:[],xSlice:[0,1],ySlice:[0,1],zSlice:[0,1],ready:!1}}function fe(e,t){if(t.type===ue){var r=t.channels,n=void 0===r?[]:r,i=t.selections,o=void 0===i?[]:i,a=t.colors,c=void 0===a?[]:a,s=t.domains,u=void 0===s?[]:s,l=t.contrastLimits,f=void 0===l?[]:l,d=t.useLens,p=void 0!==d&&d,v=t.useColorMap,m=void 0!==v&&v,h=t.xSlice,b=void 0===h?[0,1]:h,y=t.ySlice,g=void 0===y?[0,1]:y,O=t.zSlice,w=void 0===O?[0,1]:O,x=t.use3D,j=void 0!==x&&x,P=t.ready,S=void 0!==P&&P;return{channels:n,channelsVisibility:n.map((function(e){return!0})),selections:o,globalSelection:o.slice(),pixelValues:new Array(o.length).fill("-----"),colors:c,domains:u,contrastLimits:f,useLens:p,useColorMap:m,xSlice:b,ySlice:g,zSlice:w,use3D:j,ready:S}}return e}function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){return{}}function ve(){var e=(0,i.useReducer)(j,{},pe),t=(0,u.Z)(e,2),r=t[0],n=t[1];!function(e,t){var r=e||{},n=r.url,o=r.offsetsUrl,a=r.source;(0,i.useEffect)((function(){n&&(t({type:p}),function(){return U.apply(this,arguments)}({url:n,offsetsUrl:o}).then((function(e){return t({type:v,source:e})})).catch((function(e){return t({type:m,error:e.message})})))}),[n,o,t])}(r,n);var o=function(e){var t=(0,i.useReducer)(fe,{},le),r=(0,u.Z)(t,2),n=r[0],o=r[1],a=function(e){var t=e.imageIndex,r=void 0===t?0:t,n=e.metadata,i=void 0===n?[]:n;if(!(r<0||r>=i.length))return i[r]}(e),c=T(e),s=(0,i.useRef)(0);return(0,i.useEffect)((0,P.Z)(L().mark((function e(){var t,r,n,i,l,f,d,p,v,m,h,b,y,g,O,w,x,j,P,S;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a||!c){e.next=33;break}if(t=_(c[0]),s.current=s.current+1,r=s.current,n=a.Pixels,i=void 0===n?{}:n,l=c[0]||{},f=l.shape,d=i.Channels,p=void 0===d?[]:d,v=[],m=[],h=[],b=!1,y=!1,!N(a)){e.next=18;break}$(f)?(v=ce.slice(),h=ce.slice(),m=[ne]):(v=[ce.slice(),ce.slice(),ce.slice()],h=[ce.slice(),ce.slice(),ce.slice()],m=[ne,ie,oe]),b=!1,y=!1,e.next=28;break;case 18:return e.next=20,Y({loader:c,selections:t,use3d:!1});case 20:if(g=e.sent,r===s.current){e.next=23;break}return e.abrupt("return");case 23:h=g.domains.slice(),v=g.contrastLimits.slice(),m=1===g.domains.length?[ae]:g.domains.map((function(e,t){return se[t]})),b=p.length>1,y=!0;case 28:O=p.map(re),w=te(c),x=(0,u.Z)(w,3),j=x[0],P=x[1],S=x[2],o({type:ue,channels:O,selections:t,useLens:b,useColorMap:y,colors:m,domains:h,contrastLimits:v,xSlice:j,ySlice:P,zSlice:S,ready:!0}),e.next=34;break;case 33:o({type:ue});case 34:case"end":return e.stop()}}),e)}))),[a,c,s,o]),{state:n,dispatch:o}}(r),a=o.state,c=o.dispatch,l=(0,i.useCallback)((function(e,t,r){n({url:e,offsetsUrl:t,callback:r,type:d})}),[n]),f=(0,i.useCallback)((function(e){n(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({type:h},e))}),[n]);return{callbacks:(0,i.useMemo)((function(){return{setData:l,setImage:f}}),[l,f]),dispatch:n,state:r,viewerState:a,viewerDispatch:c}}function me(e){var t=e.className,r=e.onStateChange,n=e.onRegisterStateActions,o=e.onViewerStateChanged,a=e.style,c=ve(),s=c.state,l=c.viewerState,d=c.callbacks,p=(0,i.useRef)(),v=function(e){var t=(0,i.useState)({width:void 0,height:void 0}),r=(0,u.Z)(t,2),n=r[0],o=r[1];return(0,i.useEffect)((function(){var t,r,n;return function i(){var a,c,s=null==e||null===(a=e.current)||void 0===a?void 0:a.clientWidth,u=null==e||null===(c=e.current)||void 0===c?void 0:c.clientHeight;e&&e.current&&(s!==t||u!==r)&&o({width:t=s,height:r=u}),n=requestAnimationFrame(i)}(),function(){return cancelAnimationFrame(n)}}),[e,o]),n}(p);(0,i.useEffect)((function(){r&&r(s)}),[s,r]),(0,i.useEffect)((function(){o&&o(l)}),[l,o]),(0,i.useEffect)((function(){n&&n(d)}),[d,n]);var m=T(s),h=l.channelsVisibility,b=void 0===h?[]:h,y=l.contrastLimits,g=void 0===y?[]:y,O=l.colors,w=void 0===O?[]:O,x=(l.domains,l.selections),j=void 0===x?[]:x,P=l.ready,S=m&&void 0!==P&&P&&v&&v.width&&v.height;return i.createElement(f.Provider,{value:s},i.createElement("div",{className:t,style:Object.assign({position:"relative"},a||{}),ref:p},S&&i.createElement(R.J9,{contrastLimits:g,colors:w,channelsVisible:b,loader:m,selections:j,height:v.height,width:v.width})))}me.propTypes={className:c().string,onSourceLoaded:c().func,onStateChange:c().func,onRegisterStateActions:c().func,onViewerStateChanged:c().func,style:c().object};var he=me;function be(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,a=t.onStateChange,c=t.onRegisterStateActions,s=t.onViewerStateChanged;o.render(i.createElement(he,(0,n.Z)({onRegisterStateActions:c,onStateChange:a,onViewerStateChanged:s},r)),e)}},802:function(){},2195:function(){},1998:function(){},9521:function(){},9214:function(){},3752:function(){},3640:function(){},2630:function(){}}]);